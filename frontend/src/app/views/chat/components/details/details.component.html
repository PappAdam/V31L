<div class="details-wrapper" [attr.data-state]="detailsState$ | async">
  <div class="inner-wrapper">
    <div class="chat-edit-wrapper">
      <div class="image-input-wrapper">
        <input
          #imageSelector
          type="file"
          (change)="onImageUpload($event)"
          accept="image/*"
          hidden
          class="image-input"
          [formControl]="imageInput"
        />
        <div class="image-selected">
          @if (imgUploaded) {
          <img [src]="img" alt="" />
          <mat-icon
            class="remove-btn"
            fontIcon="close"
            (click)="removeImage()"
          ></mat-icon>
          } @else {
          <img [src]="this.chat?.img?.data || null" alt="" />
          <mat-icon
            class="remove-btn"
            fontIcon="edit"
            (click)="imageSelector.click()"
          ></mat-icon>
          }
        </div>
      </div>
      <div class="edit-form">
        <mat-form-field
          appearance="outline"
          [style.width]="'100%'"
          [style.height]="'50%'"
        >
          <mat-label>{{ this.chat?.name }}</mat-label>
          <input
            matInput
            [formControl]="newChatName"
            placeholder="Enter chat name"
            maxlength="30"
            type="text"
            name="chatName"
          />
        </mat-form-field>
        <div class="buttons">
          <button mat-fab type="submit" class="reset-btn" (click)="onReset()">
            <mat-icon>undo</mat-icon>
          </button>
          <button mat-fab type="submit" (click)="onEditChat()">
            <mat-icon>save</mat-icon>
          </button>
        </div>
      </div>
    </div>
    <div class="group-action-wrapper">
      <app-group-option-card fontIcon="add" label="Add member" type="expand">
        <div class="inv-body" #invBody [style.height.px]="invHeight$ | async">
          @if (invitation$ |async; as invitation) {
          <app-qrcode class="inv-qr-code" [from]="invitation" />
          <mat-divider></mat-divider>
          <div class="inv-string-container">
            <p>
              {{ invitation.slice(0, 15) }}...{{
                invitation.slice(invitation.length - 15)
              }}
            </p>
          </div>
          <button mat-flat-button (click)="copyToClipboard(invitation)">
            Copy to clipboard
          </button>
          } @else {
          <mat-spinner diameter="40"></mat-spinner>
          }
        </div>
      </app-group-option-card>
      <app-group-option-card
        fontIcon="push_pin"
        label="Pinned messages"
        type="expand"
        (expanded)="onPinnedMessageExpand()"
      >
        @for (message of (messageService.pinnedMessages$ | async); track $index)
        {
        <app-message
          [message]="message"
          [first]="true"
          [displayedIn]="'PinnedMessages'"
        ></app-message>
        }
      </app-group-option-card>
      <app-group-option-card
        fontIcon="logout"
        label="Leave chat"
        (click)="onLeaveChat()"
      >
      </app-group-option-card>
    </div>
    <div class="group-members-wrapper">
      @for (chatMember of (messageService.selectedChat$ | async)?.users; track
      $index) {
      <app-group-member-card
        [name]="chatMember.username"
        [img]="chatMember.img.data"
      ></app-group-member-card>
      }
    </div>
  </div>
</div>
